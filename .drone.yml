# database container deployment
kind: pipeline
name: BD

steps:  
  - name: deploy-mysql-container
    image: hub.codefirst.iut.uca.fr/thomas.bellembois/codefirst-dockerproxy-clientdrone:latest
    environment:
      IMAGENAME: mysql:8.0
      CONTAINERNAME: mysql
      COMMAND: create
      # OVERWRITE: false
      PRIVATE: true
      CODEFIRST_CLIENTDRONE_ENV_MYSQL_ROOT_PASSWORD:          
        from_secret: R00tPassw0rd*        
      CODEFIRST_CLIENTDRONE_ENV_MYSQL_DATABASE:          
        from_secret: DataBob       
      CODEFIRST_CLIENTDRONE_ENV_MYSQL_USER:          
        from_secret: bob       
      CODEFIRST_CLIENTDRONE_ENV_MYSQL_PASSWORD:          
        from_secret: B0bPassw0rd*


  - name: docker-build-and-push
    image: plugins/docker
    settings:
       dockerfile: /Dockerfile
       context: /
       registry: hub.codefirst.iut.uca.fr
       repo: hub.codefirst.iut.uca.fr/BOB_PARTEAM/BOB_PARTY
       username:
         from_secret: SECRET_REGISTRY_USERNAME
       password:
         from_secret: SECRET_REGISTRY_PASSWORD


   - name: deploy-container
     image: hub.codefirst.iut.uca.fr/thomas.bellembois/codefirst-dockerproxy-clientdrone:latest
     environment:
        IMAGENAME: hub.codefirst.iut.uca.fr/BOB_PARTEAM/BOB_PARTY:latest
        CONTAINERNAME: container_react
        COMMAND: create
        OVERWRITE: true