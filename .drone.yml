# This file creates our 2 docker containers
kind: pipeline
name: Dockers_Builder


# Creation of the DB docker
steps:  
  # database container deployment
  - name: deploy-container-mysql
    image: hub.codefirst.iut.uca.fr/thomas.bellembois/codefirst-dockerproxy-clientdrone:latest
    environment:
        IMAGENAME: mysql:8.0
        CONTAINERNAME: mysql
        COMMAND: create
        # OVERWRITE: false
        PRIVATE: false
        CODEFIRST_CLIENTDRONE_ENV_MYSQL_ROOT_PASSWORD:
          from_secret: db_root_password
        CODEFIRST_CLIENTDRONE_ENV_MYSQL_DATABASE:
          from_secret: db_database
        CODEFIRST_CLIENTDRONE_ENV_MYSQL_USER:
          from_secret: db_user
        CODEFIRST_CLIENTDRONE_ENV_MYSQL_PASSWORD:
          from_secret: db_password


# # docker image build (at least I'm trying)
#   - name: docker-build-and-push
#     image: plugins/docker
#     settings:
#       dockerfile: Dockerfile
#       context: .
#       registry: hub.codefirst.iut.uca.fr
#       repo: hub.codefirst.iut.uca.fr/lilian.breton/bobparty
#       username:
#         from_secret: SECRET_REGISTRY_USERNAME
#       password:
#         from_secret: SECRET_REGISTRY_PASSWORD

#container deployment
  # - name: deploy-bob_party-container
  #   image: hub.codefirst.iut.uca.fr/thomas.bellembois/codefirst-dockerproxy-clientdrone:latest
  #   environment:
  #      IMAGENAME: hub.codefirst.iut.uca.fr/lilian.breton/bobparty:latest
  #      CONTAINERNAME: bob_party_container
  #      COMMAND: create
  #      OVERWRITE: true