# This file creates our 2 docker containers
kind: pipeline
name: Dockers_Builder


# Creation of the DB docker
steps:  
  version: '3.3'
  services:
    db:
      image: mysql:5.7
      restart: always
      environment:
          - MYSQL_DATABASE=${MYSQL_DATABASE}
          - MYSQL_USER=${MYSQL_USER}
          - MYSQL_PASSWORD=${MYSQL_PASSWORD}
          - MYSQL_ROOT_PASSWORD=${MYSQL_ROOT_PASSWORD}
      ports:
        - '3306:3306'
      expose:
        - '3306'
      volumes:
        - my-db:/var/lib/mysql
  volumes:
    my-db:



# docker image build (at least I'm trying)
  # - name: docker-build-and-push
  #   image: plugins/docker
  #   settings:
  #      dockerfile: Dockerfile
  #      context: .
  #      registry: hub.codefirst.iut.uca.fr
  #      repo: hub.codefirst.iut.uca.fr/lilian.breton/bobparty
  #      username:
  #        from_secret: SECRET_REGISTRY_USERNAME
  #      password:
  #        from_secret: SECRET_REGISTRY_PASSWORD

# container deployment
  # - name: deploy-bob_party-container
  #   image: hub.codefirst.iut.uca.fr/thomas.bellembois/codefirst-dockerproxy-clientdrone:latest
  #   environment:
  #       IMAGENAME: hub.codefirst.iut.uca.fr/lilian.breton/bobparty:latest
  #       CONTAINERNAME: bob_party_container
  #       COMMAND: create
  #       OVERWRITE: true